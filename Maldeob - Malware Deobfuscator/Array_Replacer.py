import sys, argparse, re, jsbeautifier


def Pull_Array(Converted_Text):
    i = 0 
    b = 0        

    #Checks and pulls array variable name
    Array_Name_Regex1 = r"var\s(.*?)\s\=\s\["
    Array_Name_Match1 = re.search(Array_Name_Regex1, Converted_Text, re.MULTILINE)

    Array_Name_Regex2 = r"var\s(.*?)\=\["
    Array_Name_Match2 = re.search(Array_Name_Regex2, Converted_Text, re.MULTILINE)

    Array_Name_Regex3 = r"var\s(.*?)\=\s\["
    Array_Name_Match3 = re.search(Array_Name_Regex3, Converted_Text, re.MULTILINE)

    Array_Name_Regex4 = r"var\s(.*?)\s\=\["
    Array_Name_Match4 = re.search(Array_Name_Regex4, Converted_Text, re.MULTILINE)

    if Array_Name_Match1:
        VarName = Array_Name_Match1.group(1)
    elif Array_Name_Match2:
        VarName = Array_Name_Match2.group(1)  
    elif Array_Name_Match3:
        VarName = Array_Name_Match3.group(1)
    elif Array_Name_Match4:
        VarName = Array_Name_Match4.group(1)
    VarName = VarName.strip()
    
    
    #Error checks to ensure Variable name was pulled successfully
    try:
        VarName
    except:
        print('')
        print('Could not find array variable name. Please supply variable name to replace.')
        print('')
        VarName = input()
        print("########################################################")
        
        if VarName == '':
            print("You have entered an empty name.")
            print("Please enter a name of the array variable. Exiting.")
            print('')
            exit()


    #Checks & pulls array contents
    Array_Contents_Regex1 = r"var.*?\=\s\[(.*?)\]"
    Array_Contents_Name1 = re.search(Array_Contents_Regex1, Converted_Text, re.MULTILINE)

    Array_Contents_Regex2 = r"var.*?\=\[(.*?)\]"
    Array_Contents_Name2 = re.search(Array_Contents_Regex2, Converted_Text, re.MULTILINE)

    if Array_Contents_Name1:
        ArrayContents = str(Array_Contents_Name1.group(1).replace('\'','')).split(',')
    elif Array_Contents_Name2:
        ArrayContents = str(Array_Contents_Name2.group(1).replace('\'','')).split(',')

    while i < len(ArrayContents):
        item = VarName+"[{}]".format(b)
        text_after = Converted_Text.replace(item, ArrayContents[i])
        Converted_Text = text_after
        
        i += 1
        b = str(int(b)+1)
    
    # Checks to see if any array contents were not converted.
    UnconvertedText = re.search(rf"^({VarName}\[)", Converted_Text, flags=re.M)
    
    
    if UnconvertedText:
        line_index = 0
        print("Not all array indexes were replaced. Some array indexs are being calulated with other variables.")      
        print('')
        for line in Converted_Text.splitlines():
            line_index += 1
            UnconvertedText = re.search(rf"^({VarName}\[)", line, flags=re.M)
            if UnconvertedText:
                print("Unconverted Text found at line: {}".format(line_index) + "  ->  {}".format(line))
                print("")        
    else:
        pass

    return(Converted_Text)